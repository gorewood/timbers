+++
title = 'Dev Log: 2026-02-13'
date = '2026-02-13'
+++

The big theme this round: making timbers work for more than just Claude, and giving entries a memory.

Started at the foundation — an `AgentEnv` interface with a registry pattern. The debate was registry vs. switch statement, and registry won cleanly. Each agent environment lives in a single file, registers itself via `init()`, and implements `Detect`/`Install`/`Remove`/`Check`. Adding Gemini or Codex later becomes a one-file affair with zero changes to existing code. The switch approach would've centralized everything but scattered modifications across the codebase every time a new env showed up. **Self-contained beats centralized when the growth axis is "more of these."**

With the interface in place, `init`, `doctor`, `setup`, and `uninstall` all got refactored to speak generic agent-env. `--no-claude` became `--no-agent` (deprecated alias preserved because breaking people's scripts is rude). Doctor now iterates `AllAgentEnvs()` for health checks. A surprisingly hefty chunk of plumbing scattered across the codebase, but the commands read much cleaner now.

The other big addition: **`notes`**. Entries already had what/why/how, but there was no home for the *journey* — the alternatives explored, the "we almost did X but then realized Y" deliberation that makes entries actually useful six months later. `notes` captures that. The key design insight: `why` is the verdict, `notes` is the path to the verdict. Coaching uses the same question-not-structure approach that worked for `why` — a BAD/GOOD example block that steers agents without being prescriptive. The field landed with `--notes` on the CLI, a corresponding MCP input field, prime coaching text, truncated verbose display, and template hints for `timbers draft`.

Then came the satisfying proof that `notes` actually matters. Regenerated all the site example artifacts from the real ledger — 55 genuine entries with notes versus the old 30 backfilled entries with shallow `why` fields. The decision log went from 9 ADRs (most hollow) to 6 ADRs where every one has real fork-in-the-road context. ADR-4 (the registry pattern decision) includes *quoted notes from the entry itself*. First time notes enriched template output, and the difference is night and day.

A couple of test fixes worth mentioning: `TestCommitFiles` was silently relying on the live repo's HEAD, which breaks when HEAD is a merge commit because `diff-tree` returns empty. Fix was obvious in hindsight — create an isolated temp repo with two commits so the test owns its own state. Same energy with `TestRepoRoot` failing in worktree environments because of a hardcoded directory name. Swapped to absolute path comparison. These are the kind of bugs that only surface when your own development environment evolves past your test assumptions.

Also shipped v0.7.0 (MCP server with 6 tools over stdio) and v0.8.0 (the notes feature). The MCP server is the highest-leverage integration bet — one implementation covers Claude Code, Cursor, Windsurf, Gemini CLI, and others without per-tool CLI wrappers. Handlers call `internal/` packages directly, filter functions moved to `internal/ledger/` for sharing between CLI and MCP paths. Added `idempotentHint` to read tools so clients can cache and retry safely.

Small operational tweak at the end: switched the devblog CI from weekly to daily. The commit cadence doesn't batch well into weeks — too much context gets lost. Daily at 9am UTC with `--since 1d` matches the actual rhythm of work.

---

*This post was drafted with AI assistance from development log entries.*
